{% extends "TisseoCoreBundle::container.html.twig" %}
{% set bundle = 'TisseoBoaBundle' %}
{% set smoothness = true %}
{% set datatable = true %}
{% set paginate = 'true' %}

{% import "TisseoBoaBundle::macros.html.twig" as render %}

{% block main_content %}
    <h1>
        {{'trip.list.title'|trans({}, 'default')}}
        {% if (is_granted('BUSINESS_MANAGE_ROUTES')) %}
            -
            <a href="{{ path('tisseo_boa_trip_create', {'routeId': route.id}) }}" data-toggle="modal" data-target="#base-modal" class="btn btn-success">
                <span class="glyphicon glyphicon-plus"></span> {{ 'trip.create'|trans({}, 'default') }}
            </a>
        {% endif %}
    </h1>
    <hr/>

    <a id="route" class="header-ribbon">
        <span class="glyphicon glyphicon-list"></span> {{ render.route_header(route) }}
    </a>
    <table class="table table-hover datatable">
        <thead>
            <th class="col-md-2">{{ 'trip.list.columns.name'|trans({}, 'default') }}</th>
            <th class="col-md-2">{{ 'trip.list.columns.start'|trans({}, 'default') }}</th>
            <th class="col-md-1">{{ 'trip.list.columns.type'|trans({}, 'default') }}</th>
            <th class="col-md-1">{{ 'trip.list.columns.day'|trans({}, 'default') }}</th>
            <th class="col-md-2">{{ 'trip.list.columns.period'|trans({}, 'default') }}</th>
            <th class="col-md-1">{{ 'trip.list.columns.lastDay'|trans({}, 'default') }}</th>
            <th class="col-md-3 no-sort no-search">{{ 'global.actions'|trans }}</th>
        </thead>
        <tbody>
            {% for trip in route.TripsNotPattern %}
                {% set stopTime = trip.FirstStopTime %}
                {% set bounds = tripBounds[trip.id] %}
                <tr>
                    <td>{{ trip.name }}</td>
                    <td>{% if stopTime %}{{ stopTime.arrivalTime|date('H:i', false) }}{% endif %}</td>
                    <td>{% if trip.pattern %}{{ trip.pattern.name }}{% endif %}</td>
                    <td>
                        {% if trip.dayCalendar %}
                            <a href="{{ path('tisseo_boa_calendar_edit', {'calendarId': trip.dayCalendar.id}) }}">
                                {{ trip.dayCalendar.name }}
                            </a>
                        {% endif %}
                    </td>
                    <td>
                        {% if trip.periodCalendar %}
                            <a href="{{ path('tisseo_boa_calendar_edit', {'calendarId': trip.periodCalendar.id}) }}">
                                {{ trip.periodCalendar.name }}
                            </a>
                        {% endif %}
                    </td>
                    <td>{% if bounds %}{{ bounds['end']|date("d/m/Y") }}{% endif %}</td>
                    <td>
                        <a class="btn btn-default" href="{{ path('tisseo_boa_trip_edit', {'tripId': trip.id}) }}">
                            <span class="glyphicon glyphicon-pencil"></span> {{ 'global.edit'|trans }}
                        </a>
                        <a class="btn {% if bounds and bounds['start'] < yesterday %}btn-danger{% else %}btn-default{% endif %} delete-action" href="{{ path('tisseo_boa_trip_delete', {'tripId': trip.id}) }}">
                            <span class="glyphicon glyphicon-remove"></span> {{ 'global.delete'|trans }}
                        </a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block javascripts %}
    <script>
        require(['jquery', 'core/datatables'], function($) {
            datatable(true);
        });
    </script>
{% endblock %}
