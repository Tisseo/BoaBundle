{% extends "::modal.html.twig" %}

{% form_theme form 'TisseoBoaBundle:Form:fields.html.twig' %}

{% block modal_title %}
    {{ title|trans({}, 'default') ~ " " ~ stopAreaLabel }}
{% endblock %}

{% block open_form %}
    {{ form_start(form) }}
{% endblock %}

{% block modal_body %}
    {{ form_errors(form) }}
	{{ form_widget(form._token) }}
	
{#	{{ dump(transfers) }}	#}

	<div class="row">
		<div class = "col-md-4"> {{ form_label(form.transferDuration) }} </div> 
		<div class = "col-md-1"> {{ form_widget(form.transferDuration) }} </div> 
	</div>
	
	<div>
		<div class="stop_table_header">{{ 'stop_area.labels.internal_transfert' | trans }}</div>
		<table 
			id='transfer_table'
			class="table table-hover dataTable no-footer"
		>
		<thead>
			<th>{{ 'stop_area.transfer.columns.startStop' | trans }}</th>
			<th>{{ 'stop_area.transfer.columns.endStop' | trans }}</th>
			<th>{{ 'stop_area.transfer.columns.duration' | trans }}</th>
			<th>{{ 'stop_area.transfer.columns.distance' | trans }}</th>
			<th>{{ 'stop_area.transfer.columns.longName' | trans }}</th>
			<th>{{ 'stop_area.transfer.columns.theGeom' | trans }}</th>
		</thead>
		<tbody>
			{% set index = 0 %}
			{%  for startStop in stops %}
				{%  if startStop.masterStop is empty %}
					{%  for endStop in stops %}
						{%  if endStop.masterStop is empty %}
								{% set transfer_key = startStop.id ~ "." ~ endStop.id %}
								{% set transfer_id_value = "" %}
								{% set transfer_duration_value = "" %}
								{% set transfer_distance_value = "" %}
								{% set transfer_longName_value = "" %}
								{% set transfer_theGeom_value = "" %}
								{% if transfer_key in transfers|keys %}
									{% set transfer_id_value = "value=" ~ transfers[transfer_key].id %}
									{% set transfer_duration_value = "value=" ~ transfers[transfer_key].duration %}
									{% set transfer_distance_value = "value=" ~ transfers[transfer_key].distance %}
									{% set transfer_longName_value = "value=" ~ transfers[transfer_key].longName %}
									{% set transfer_theGeom_value = "value=" ~ transfers[transfer_key].theGeom %}
								{% endif %}
							<tr>
								<td>
									<input type='hidden' id="transfer_{{ index }}_id" name="transfer[{{ index }}][id]" {{ transfer_id_value }}>
									<input type='hidden' id="transfer_{{ index }}_startStopId" name="transfer[{{ index }}][startStopId]" value="{{ startStop.id }}">
									{{ startStop.getStopLabel }}
								</td>	
								<td>
									<input type='hidden' id="transfer_{{ index }}_endStopId" name="transfer[{{ index }}][endStopId]" value="{{ endStop.id }}">
									{{ endStop.getStopLabel }}
								</td>	
								<td><input type='text' id="transfer_{{ index }}_duration" name="transfer[{{ index }}][duration]" class="form-control" {{ transfer_duration_value }} ></td>	
								<td><input type='text' id="transfer_{{ index }}_distance" name="transfer[{{ index }}][distance]" class="form-control" {{ transfer_distance_value }} ></td>	
								<td><input type='text' id="transfer_{{ index }}_longName" name="transfer[{{ index }}][longName]" class="form-control" {{ transfer_longName_value }} ></td>	
								<td><input type='text' id="transfer_{{ index }}_theGeom" name="transfer[{{ index }}][theGeom]" class="form-control" {{ transfer_theGeom_value }} ></td>	
							</tr>
							{% set index = index + 1 %}
						{%  endif %}
					{%  endfor %}
				{%  endif %}
			{%  endfor %}
		</tbody>
		</table>
	</div>
{% endblock %}

{% block modal_actions %}
    <button type="submit" class="btn btn-success">
        <span class="glyphicon glyphicon-pencil"></span>{{ 'global.save'|trans }}
    </button>
    {{ form_end(form, { 'render_rest': false}) }}
	<script>   
		require(['jquery'], function($) {
			$('.modal-dialog').css('width', '1300px');
		});
    </script>		
{% endblock %}
